<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .navbar {background-color: #007bff; padding: 0; margin-bottom: 20px; border-radius: 0 0 8px 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);}
        .navbar-menu {list-style: none; margin: 0; padding: 0 20px; display: flex; align-items: center; height: 48px;}
        .navbar-menu > li {position: relative;}
        .navbar-menu > li > a {display: block; color: #fff; text-decoration: none; padding: 0 18px; line-height: 48px; font-weight: bold; transition: background 0.2s; border-radius: 4px;}
        .navbar-menu > li > a:hover, .navbar-menu > li.dropdown:hover > a {background: #0056b3;}
        .dropdown-menu {display: none; position: absolute; background: #fff; min-width: 160px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-radius: 4px; top: 48px; left: 0; z-index: 1000; padding: 6px 0;}
        .dropdown-menu li a {color: #333; padding: 8px 18px; display: block; text-decoration: none; border-radius: 0; font-weight: normal;}
        .dropdown-menu li a:hover {background: #f2f2f2;}
        .navbar-menu > li.dropdown:hover .dropdown-menu {display: block;}
        @media (max-width: 700px) {.navbar-menu {flex-direction: column; height: auto;} .navbar-menu > li {width: 100%;} .navbar-menu > li > a {padding: 0 10px;} .dropdown-menu {position: static; box-shadow: none; min-width: 100%;}}
        .card-metric {background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.07); padding: 24px; flex: 1; min-width: 220px; display: flex; align-items: center; gap: 18px;}
        .card-products {background: linear-gradient(90deg, #4e54c8 0%, #8f94fb 100%); color: #fff;}
        .card-suppliers {background: linear-gradient(90deg, #43cea2 0%, #185a9d 100%); color: #fff;}
        .card-purchase {background: linear-gradient(90deg, #ffb347 0%, #ffcc33 100%); color: #fff;}
        .card-sales {background: linear-gradient(90deg, #ff5f6d 0%, #ffc371 100%); color: #fff;}
        .card-value {background: linear-gradient(90deg, #36d1c4 0%, #b2fefa 100%); color: #fff;}
        .card-metric .fa-solid {font-size: 2.5rem; margin-right: 10px;}
        .loading-spinner {display: none; justify-content: center; align-items: center; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(255,255,255,0.7); z-index: 9999;}
        .loading-spinner .fa-spinner {font-size: 3rem; color: #007bff; animation: spin 1s linear infinite;}
        @keyframes spin {100% {transform: rotate(360deg);}}
    </style>
</head>
<body>
    {% include '_navbar.html' %}
    <div style="max-width: 100%; margin: 0 auto; padding-left: 2%; padding-right: 2%; padding-top: 24px; padding-bottom: 24px; width: 96%; box-sizing: border-box;">
        <h1 style="color: #007bff; font-size: 2.5rem; margin-bottom: 18px;">Pharmacy Dashboard</h1>
    <form method="post" style="margin-bottom: 24px; display: flex; gap: 16px; align-items: center;" onsubmit="showLoading()">
    <div class="loading-spinner" id="loadingSpinner">
        <i class="fa-solid fa-spinner"></i>
    </div>
            <label for="from_date" style="font-weight: bold; color: #333;">From Date:</label>
            <input type="date" id="from_date" name="from_date" value="{{ from_date }}" style="padding: 6px 12px; border-radius: 4px; border: 1px solid #ccc;">
            <label for="to_date" style="font-weight: bold; color: #333;">To Date:</label>
            <input type="date" id="to_date" name="to_date" value="{{ to_date }}" style="padding: 6px 12px; border-radius: 4px; border: 1px solid #ccc;">
            <button type="submit" style="background: #007bff; color: #fff; border: none; border-radius: 4px; padding: 8px 18px; font-weight: bold; cursor: pointer;">Filter</button>
        </form>
        <div style="display: flex; gap: 24px; flex-wrap: wrap; margin-bottom: 32px;">
            <div class="card-metric card-products">
                <i class="fa-solid fa-capsules"></i>
                <div>
                    <h2 style="font-size: 1.3rem; margin-bottom: 8px;">Total Products</h2>
                    <div style="font-size: 2.2rem; font-weight: bold;">{{ total_products }}</div>
                </div>
            </div>
            <div class="card-metric card-suppliers">
                <i class="fa-solid fa-truck"></i>
                <div>
                    <h2 style="font-size: 1.3rem; margin-bottom: 8px;">Total Suppliers</h2>
                    <div style="font-size: 2.2rem; font-weight: bold;">{{ total_suppliers }}</div>
                </div>
            </div>
            <div class="card-metric card-purchase">
                <i class="fa-solid fa-file-invoice-dollar"></i>
                <div>
                    <h2 style="font-size: 1.3rem; margin-bottom: 8px;">Total Purchase Bills</h2>
                    <div style="font-size: 2.2rem; font-weight: bold;">{{ total_purchase_bills }}</div>
                </div>
            </div>
            <div class="card-metric card-sales">
                <i class="fa-solid fa-receipt"></i>
                <div>
                    <h2 style="font-size: 1.3rem; margin-bottom: 8px;">Total Sales Bills</h2>
                    <div style="font-size: 2.2rem; font-weight: bold;">{{ total_sales_bills }}</div>
                </div>
            </div>
            <div class="card-metric card-value">
                <i class="fa-solid fa-indian-rupee-sign"></i>
                <div>
                    <h2 style="font-size: 1.3rem; margin-bottom: 8px;">Total Purchase Value</h2>
                    <div style="font-size: 2.2rem; font-weight: bold;">₹{{ total_purchase_value }}</div>
                </div>
            </div>
            <div class="card-metric card-value">
                <i class="fa-solid fa-indian-rupee-sign"></i>
                <div>
                    <h2 style="font-size: 1.3rem; margin-bottom: 8px;">Total Sales Value</h2>
                    <div style="font-size: 2.2rem; font-weight: bold;">₹{{ total_sales_value }}</div>
                </div>
            </div>
        </div>
    <script>
        function showLoading() {
            document.getElementById('loadingSpinner').style.display = 'flex';
        }
    </script>
        <div style="margin-top: 24px; display: flex; gap: 32px; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 400px;">
                <div style="background: linear-gradient(90deg, #ff5f6d 0%, #ffc371 100%); color: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); padding: 18px 18px 8px 18px; margin-bottom: 18px;">
                    <h2 style="font-size: 1.5rem; margin-bottom: 12px; display: flex; align-items: center;"><i class="fa-solid fa-receipt" style="margin-right: 10px;"></i>Sales (Filtered by Date Range)</h2>
                    <div style="max-height: 350px; overflow-y: auto; overflow-x: auto; border-radius: 8px; background: #fff; color: #333;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead style="background: #e9ecef;">
                                <tr>
                                    <th style="padding: 10px; text-align: left;">Bill No</th>
                                    <th style="padding: 10px; text-align: left;">Bill Date</th>
                                    <th style="padding: 10px; text-align: left;">Patient Name</th>
                                    <th style="padding: 10px; text-align: left;">View</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for sale in recent_sales %}
                                <tr>
                                    <td style="padding: 10px;">{{ sale.BillNo }}</td>
                                    <td style="padding: 10px;">{{ sale.BillDate }}</td>
                                    <td style="padding: 10px;">{{ sale.PatientName }}</td>
                                    <td style="padding: 10px;">
                                        <form method="get" action="/billdetails" style="margin:0;">
                                            <input type="hidden" name="bill_no" value="{{ sale.BillNo }}">
                                            <button type="submit" style="background: #ff5f6d; color: #fff; border: none; border-radius: 4px; padding: 6px 14px; font-weight: bold; cursor: pointer;">
                                                <i class="fa-solid fa-eye"></i> View Details
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div style="flex: 1; min-width: 400px;">
                <div style="background: linear-gradient(90deg, #ffb347 0%, #ffcc33 100%); color: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); padding: 18px 18px 8px 18px; margin-bottom: 18px;">
                    <h2 style="font-size: 1.5rem; margin-bottom: 12px; display: flex; align-items: center;"><i class="fa-solid fa-file-invoice-dollar" style="margin-right: 10px;"></i>Purchases (Filtered by Date Range)</h2>
                    <div style="max-height: 350px; overflow-y: auto; overflow-x: auto; border-radius: 8px; background: #fff; color: #333;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead style="background: #e9ecef;">
                                <tr>
                                    <th style="padding: 10px; text-align: left;">Invoice No</th>
                                    <th style="padding: 10px; text-align: left;">Invoice Date</th>
                                    <th style="padding: 10px; text-align: left;">Supplier</th>
                                    <th style="padding: 10px; text-align: left;">View</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for purchase in recent_purchases %}
                                <tr>
                                    <td style="padding: 10px;">{{ purchase.InvoiceNo }}</td>
                                    <td style="padding: 10px;">{{ purchase.InvoiceDateTime }}</td>
                                    <td style="padding: 10px;">{{ purchase.SupplierName }}</td>
                                    <td style="padding: 10px;">
                                        <form method="get" action="/purchasedetails" style="margin:0;">
                                            <input type="hidden" name="invoice_no" value="{{ purchase.InvoiceNo }}">
                                            <button type="submit" style="background: #ffb347; color: #fff; border: none; border-radius: 4px; padding: 6px 14px; font-weight: bold; cursor: pointer;">
                                                <i class="fa-solid fa-eye"></i> View Details
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
